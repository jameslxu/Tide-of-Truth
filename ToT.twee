```twine
:: StoryBanner [header]
<!-- Static header: game title + rightâ€‘aligned save button only -->
''Tide of Truth'' â€” //Predict the Waves, Protect the Town// (align:"right")[ (link:"ðŸ’¾ Save")[ (save-game:"slot1") ] ]
(line-break:)

:: StatusBar
<!-- Reusable bar displayed after each passage updates its variables -->
''Level:'' $playerLevel | ''Credit:'' $credit (if:$hourLeft < 60)[| ''Minutes left:'' $hourLeft]
(line-break:)

:: StoryFooter [footer]
<!-- empty for now -->

:: Start
(set:$playerName to (prompt:"Your Name: ","Jackie Chan"))
(set:$playerLevel to "Beginner")
(set:$credit to 0)
(set:$hourLeft to 60)
(set:$midDone to false)(set:$ampDone to false)(set:$perDone to false)
(set:$isDamFortified to false)
(set:$landfallTime to (either:0,1,2,3,4,5,6,7,8,9))
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2016/11/19/17/25/blue-1840457_1280.jpg" style="max-width:600px;">
Welcome to *Tide of Truth*. 
[[Enter->Intro]]

:: Intro
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2015/10/29/09/46/books-1012088_1280.jpg">
Youâ€™re $playerName, eager to prove your math can save lives.
* [[Begin->Backstory1]]
* [[Take a moment->WaitBreath]]

:: WaitBreath
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2018/12/20/08/07/western-gull-3885415_960_720.jpg">
You breathe the salty air on Stormhavenâ€™s pier, steadying your nerves.
[[Ready->Backstory1]]

:: Backstory1
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2023/12/05/08/23/port-8431044_1280.jpg" style="max-width:600px;">
Stormhaven is proud but vulnerable, no stranger to hurricanes.
[[Continue->Backstory2]]

:: Backstory2
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2016/08/24/08/39/man-at-sea-1616458_1280.jpg" style="max-width:600px;">
Hurricane *Calypso* brews offshoreâ€”your tideâ€‘model skills could save thousands if you earn a taskâ€‘force badge.
[[Request an interview->InterviewIntro]]

:: InterviewIntro
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2017/07/20/03/53/homework-2521144_1280.jpg" style="max-width:600px;">
The council posts a lightningâ€‘round trig quiz on the wallâ€”three questions stand between you and the lab badge.
[[Begin quiz->Q1]]

:: Q1
(display:"StatusBar")
Hypotenuse with legs 7 km & 24 km?
* [[14 km->WrongQ1]]
* [[17 km->WrongQ1]]
* [[25 km->Q2]]
* [[31 km->WrongQ1]]

:: WrongQ1
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
Not quiteâ€”remember the 7â€‘24â€‘25 triple.
(link:"Video help")[(open-url:"https://youtu.be/77XAdyWz5SM")]
[[Retry->Q1]]

:: Q2
(display:"StatusBar")
If sin Î¸ = 3/4 and opposite = 9 m, hypotenuse?
* [[12 m->Q3]]
* [[7.5 m->WrongQ2]]
* [[6 m->WrongQ2]]
* [[3 m->WrongQ2]]

:: WrongQ2
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
Hint: hyp = 9 Ã· 0.75.
(link:"Video")[(open-url:"https://youtu.be/77XAdyWz5SM")]
[[Retry->Q2]]

:: Q3
(display:"StatusBar")
Hypotenuse = 5 m, opposite = 4 m. sin Î¸?
* [[0.80->InterviewPass]]
* [[1.60->WrongQ3]]
* [[1.25->WrongQ3]]
* [[3.00->WrongQ3]]

:: WrongQ3
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
sin Î¸ = 4 / 5 = 0.8.
[[Retry->Q3]]

:: InterviewPass
(set:$playerLevel to "Assistant")(set:$credit to (min:200,$credit+50))
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2024/07/10/18/35/18-35-03-832_512.gif" style="max-width:180px; float:right;">
***Promoted to Assistant (+50 credit).***
[[Proceed to Bootcamp->BootcampWelcome]]

:: BootcampWelcome
(set:$hourLeft to 60)
(display:"StatusBar")
Welcome to the **Tidalâ€‘Model Bootcamp**.
(link-replace:"Bootcamp rules")[Earn **+20** credit first correct pick, **âˆ’5** for each miss.<br>Hit 100 â†’ Scientist, 150 â†’ Leading Scientist.]
[[Start work->BootcampIntro]]

:: BootcampIntro
(display:"StatusBar")
<img src="https://lh3.googleusercontent.com/pw/AP1GczMaKSbISXMR3LDjoXo4E5YfnuIfbOTxRUPfVE-wP4Pks-hPY4un2xx89LFa5UGnyH8aT_ggO2312YPPwtRwAV-jyquCpEpZ8ky6fhWJMJSH0vxuP0G2TL3-hqAbHLjDXThllgIIYMrCBPFqfzgnFT4=w531-h577-s-no-gm?authuser=0" style="max-width:500px;">
Choose a parameter to recover:
(if: not $midDone)[* [[Midline->ParamMid]]]
(if: not $ampDone)[* [[Amplitude->ParamAmp]]]
(if: not $perDone)[* [[Period->ParamPer]]]
(if: $midDone and $ampDone and $perDone)[[[Evaluate recovered model->BootcampEval]]]+(else:)[[[Skip parameter recovery and head to War Room->WarRoom]] ]

:: ParamMid
(display:"StatusBar")
<img src="https://lh3.googleusercontent.com/pw/AP1GczMaKSbISXMR3LDjoXo4E5YfnuIfbOTxRUPfVE-wP4Pks-hPY4un2xx89LFa5UGnyH8aT_ggO2312YPPwtRwAV-jyquCpEpZ8ky6fhWJMJSH0vxuP0G2TL3-hqAbHLjDXThllgIIYMrCBPFqfzgnFT4=w531-h577-s-no-gm?authuser=0" style="max-width:800px; float:right;">
Midline value?
* [[-8->MidRight]]
* [[-18->MidWrong]]
* [[14->MidWrong]]
* [[2->MidWrong]]

:: MidRight
(set:$credit to (min:200,$credit+20))(set:$midDone to true)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2024/07/10/18/35/18-35-03-832_512.gif" style="max-width:180px; float:right;">
Midline correct (+20).
[[Back->BootcampIntro]]

:: MidWrong
(set:$credit to (max:0,$credit-5))
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
âˆ’5 credit: midline sits halfway between crest & trough.
[[Retry->ParamMid]]

:: ParamAmp
(display:"StatusBar")
<img src="https://lh3.googleusercontent.com/pw/AP1GczMaKSbISXMR3LDjoXo4E5YfnuIfbOTxRUPfVE-wP4Pks-hPY4un2xx89LFa5UGnyH8aT_ggO2312YPPwtRwAV-jyquCpEpZ8ky6fhWJMJSH0vxuP0G2TL3-hqAbHLjDXThllgIIYMrCBPFqfzgnFT4=w531-h577-s-no-gm?authuser=0" style="max-width:800px; float:right;">
Amplitude?
* [[10->AmpRight]]
* [[-8->AmpWrong]]
* [[18->AmpWrong]]
* [[6->AmpWrong]]

:: AmpRight
(set:$credit to (min:200,$credit+20))(set:$ampDone to true)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2024/07/10/18/35/18-35-03-832_512.gif" style="max-width:180px; float:right;">
Amplitude correct (+20).
[[Back->BootcampIntro]]

:: AmpWrong
(set:$credit to (max:0,$credit-5))
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
âˆ’5 credit: amplitude is peak height above the midline.
[[Retry->ParamAmp]]

:: ParamPer
(display:"StatusBar")
<img src="https://lh3.googleusercontent.com/pw/AP1GczMaKSbISXMR3LDjoXo4E5YfnuIfbOTxRUPfVE-wP4Pks-hPY4un2xx89LFa5UGnyH8aT_ggO2312YPPwtRwAV-jyquCpEpZ8ky6fhWJMJSH0vxuP0G2TL3-hqAbHLjDXThllgIIYMrCBPFqfzgnFT4=w531-h577-s-no-gm?authuser=0" style="max-width:800px; float:right;">
Period?
* [[16->PerRight]]
* [[6.28->PerWrong]]
* [[0.39->PerWrong]]
* [[10->PerWrong]]

:: PerRight
(set:$credit to (min:200,$credit+20))
(set:$perDone to true)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2024/07/10/18/35/18-35-03-832_512.gif" style="max-width:180px; float:right;">
Period correct (+20).
[[Back->BootcampIntro]]

:: PerWrong
(set:$credit to (max:0,$credit-5))
(display:"StatusBar")
<img src="https://cdn.pixabay.com/animation/2023/05/13/15/05/15-05-46-966_512.gif" style="max-width:180px; float:right;">
Period = one full cycle width (âˆ’5).
[[Retry->ParamPer]]

:: BootcampEval
(display:"StatusBar")
(if:$credit >= 150)[(set:$playerLevel to "Leading Scientist")Badge unlocked! [[Enter Lab->LabStart]]]
+(elseif:$credit >= 100)[(set:$playerLevel to "Scientist")Promotion achievedâ€”welcome to the lab. [[Enter Lab->LabStart]]]
+(else:)[Credit below 100â€”use borrowed model. [[Go to War Room->WarRoom]]]

:: LabStart
(set:$Aok to false)(set:$Bok to false)(set:$Cok to false)(set:$Dok to false)
(live:60s)[(set:$hourLeft to $hourLeft-1)(if:$hourLeft <= 0)[(goto:"BootcampWelcome")]]
(display:"StatusBar")
Hurricane Calypso is ~30 h out; engineers need an hourâ€™s warning to fortify.  
Your tide model must be finished in the next **60 minutes**.  

Two data avenues beckonâ€”choose one to shape *f(x)=AÂ·sin(BÂ·(x+C))+D*:  
â€¢ [[Jamieâ€™s lighthouse logs (â€“4 min)->DataJamie]] â€” handwritten peaks via the old keeper.  
â€¢ [[Port Authority buoy stream (â€“2 min)->DataBuoy]] â€” live sensor heights from the harbor.

:: DataJamie
(set:$hourLeft to $hourLeft-4)
(display:"StatusBar")
Jamieâ€™s logs record tide peaks roughly every 5.8 h.  
These data will seed *f(x)=AÂ·sin(BÂ·(x+C))+D*, where **A** is amplitude, **B** sets frequency, **C** shifts phase, **D** is mid-sea-level.
[[Chart->LabChart]]

:: DataBuoy
(set:$hourLeft to $hourLeft-2)
(display:"StatusBar")
Buoy sensors stream tide heights every 30 minâ€”clean, high-resolution curves.  
Youâ€™ll fit them to *f(x)=AÂ·sin(BÂ·(x+C))+D* by tuning each coefficient.
[[Chart->LabChart]]

:: LabChart
(display:"StatusBar")
<img src="https://lh3.googleusercontent.com/pw/AP1GczONXZG6QUFyJzzzM2TNs47LKV5mMts3t3OPnZb5NCEYJi6bI66_tLoCVNgwKcr-2mYIDaOkJkYqijQtzn-kjHGmUEltLXGZn18LcwhbcUf_CoiK5p0uB08yrcwx28KHDt5wyiIJ0QkN_I3R-xQQD0Q=w1070-h934-s-no?authuser=0" style="max-width:800px;">
Forecast model: *f(x)=AÂ·sin(BÂ·(x+C))+D*  
Pick values that align the curve with your dataset.

A = (dropdown: bind $A,"select","5.0","4.8","1.0","3.3","12.4","36Ï€","5Ï€")
B = (dropdown: bind $B,"select","11/14","Ï€/4","22/7","1.57","3.42","2Ï€","10")
C = (dropdown: bind $C,"select","6.0","5.8","3Ï€/2","11/14","22/7","4.9","13.6")
D = (dropdown: bind $D,"select","10","11","9","12","15","8","5")

{
(if: $A is not "select" and $B is not "select"
    and $C is not "select" and $D is not "select")
  [[Submit->ModelEval]]
(else:)
  (text-color:#888)[(italic:Submit once all four are chosen)]
}


:: ModelEval
<!-- Evaluate coefficient selection, THEN show status bar so values are current -->
(set:$correct to 0)
(if:$A is "5.0" or $A is "4.8")[(set:$correct to $correct+1)]
(if:$B is "11/14" or $B is "Ï€/4")[(set:$correct to $correct+1)]
(if:$C is "6.0" or $C is "5.8")[(set:$correct to $correct+1)]
(if:$D is "10" or $D is "11" or $D is "9")[(set:$correct to $correct+1)]
<!-- Apply credit penalties BEFORE status bar -->
(if:$correct is 2)[(set:$credit to (max:0,$credit-10))]
+(elseif:$correct is 1)[(set:$credit to (max:0,$credit-20))]
+(elseif:$correct is 0)[(set:$credit to (max:0,$credit-50))]
(display:"StatusBar")
You scored $correct / 4.  
Every mismatch nudges the forecast off courseâ€”refine and outâ€‘smart the storm!

(if:$correct is 4)[[[WarRoom->WarRoom]]]
+(elseif:$correct is 3)[[[Refine (no penalty)->LabChart]]]
+(elseif:$correct is 2)[[[Retry (â€“10)->LabChart]]]
+(elseif:$correct is 1)[[[Retry (â€“20)->LabChart]]]
+(else:)[[[Retry (â€“50)->LabChart]]]
(if:$credit < 20)[(set:$playerLevel to "Assistant")(goto:"BootcampWelcome")]

:: WarRoom
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2021/10/29/09/27/lake-6751477_1280.jpg" style="max-width:600px;">
Hardâ€‘hatted engineers crowd the situation table: â€œGive us the green light,â€ they plead, concrete barriers and inflatable flood walls loaded on flatbeds.  
Your forecast shows how high Calypsoâ€™s surge may climbâ€”fortification takes the full hour you have left.  
Should the city spend the budget and raise a temporary wall before water arrives?
* [[Authorize floodâ€‘wall crews->FortYes]]
* [[Hold offâ€”trust the existing dam->FortNo]]

:: FortYes
(set:$isDamFortified to true)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2017/09/21/07/49/dam-2771008_1280.jpg" style="max-width:600px;">
Sirens echo as crews race to stack concrete blocks and inflate flood wallsâ€”only $hourLeft minutes remain as Calypsoâ€™s spiral bands creep over the horizon.
[[Outcome->Outcome]]

:: FortNo
(set:$isDamFortified to false)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2017/09/21/07/49/dam-2771008_1280.jpg" style="max-width:600px;">
You hesitateâ€”budget stays untouched as the clock ticks: just $hourLeft minutes until the surge. All eyes turn to the aging dam, silhouetted against lightning flashes.
[[Outcome->Outcome]]
(set:$isDamFortified to false)
(display:"StatusBar")
<img src="https://cdn.pixabay.com/photo/2017/09/21/07/49/dam-2771008_1280.jpg" style="max-width:600px;">
You hesitateâ€”budget stays untouched as the clock ticks: just $hourLeft minutes until the surge. All eyes turn to the aging dam, silhouetted against lightning flashes.
[[Outcome->Outcome]]â€”budget stays untouched as the clock ticks: just $hourLeft minutes until the surge.  
All eyes turn to the aging dam, silhouetted against the storm-lit horizon.  
[[Outcome->Outcome]]

:: Outcome
(display:"StatusBar")
(set:$overflow to (either:true,true,true,true,true,true,true,true,false,false))
<video src="https://cdn.pixabay.com/video/2019/12/05/29831-377694384_large.mp4" autoplay loop muted style="max-width:600px;"></video>
The roar of Calypso slams the coastâ€”spray lashes the dam as seconds crawl byâ€¦
(live:10s)[
  (if: $isDamFortified)[(goto:"EndProtected")]
  +(elseif: $overflow)[(goto:"EndFlooded")]
  +(else:)[(goto:"EndProtected")]
] slams the coastâ€”spray lashes the dam as seconds crawl byâ€¦
(live:10s)[
  (if: $isDamFortified)[(goto:"EndProtected")]
  +(elseif: $overflow)[(goto:"EndFlooded")]
  +(else:)[(goto:"EndProtected")]
]

:: EndProtected
(display:"StatusBar")
(if:$playerLevel is "Assistant")[
Your quick, clear-headed work in **Bootcamp** gave Stormhaven the numbers it neededâ€”even without time in the lab. Engineers built the floodâ€‘wall exactly where you advised, and not a single street is wet.  
]
+(else:)[
Your lab-forged tide model nailed Calypsoâ€™s crest. Crews salute your precision as the new wall holds back a roaring surge. **Scientist** notoriety earned!  
]
[[Restart->Start]]

:: EndFlooded
(display:"StatusBar")
(if:$playerLevel is "Assistant")[
Your Bootcamp insights were solid, but without a lab-tuned model the estimate fell shortâ€”the surge spilled over the aging dam. Stormhaven will rebuild, and so will your experience. Study the patterns and try again.  
]
+(else:)[
Even seasoned scientists can misread a stormâ€”one coefficient off and the flood slipped through. Calypso teaches a hard lesson: revisit your data and return stronger.  
]
[[Restart->Start]]
